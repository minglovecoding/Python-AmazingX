## ğŸ“š åŠ¨æ€è§„åˆ’ï¼ˆ**Dynamic Programming**ï¼‰

------

## ğŸ“˜ ç›®å½•

1. DPçš„åº”ç”¨åœºæ™¯
2. DP äº”è¦ç´ 
3. ç»å…¸DPæ¨¡å‹ï¼šåºåˆ— / èƒŒåŒ… / åŒºé—´ / æ ‘ä¸Š / å›¾ä¸Š / æ•°ä½ / çŠ¶å‹
4. ä¼˜åŒ–æŠ€å·§ï¼šæ»šåŠ¨æ•°ç»„ã€å•è°ƒé˜Ÿåˆ—ã€æ–œç‡ä¼˜åŒ–ã€åˆ†æ²»/å››è¾¹å½¢ä¸ç­‰å¼ã€Bitset
5. å¤æ‚åº¦ä¸è°ƒè¯•ç­–ç•¥

------

## ğŸ§© 1. DPçš„åº”ç”¨åœºæ™¯

- **é‡å å­é—®é¢˜**ï¼šå½“åŒä¸€ä¸ªå­é—®é¢˜åœ¨é€’å½’ä¸­è¢«åå¤è®¡ç®—æ—¶ï¼Œå¯ä»¥ç”¨è¡¨ï¼ˆæ•°ç»„ / å­—å…¸ï¼‰ç¼“å­˜ç»“æœä»¥èŠ‚çœæ—¶é—´ã€‚ä¾‹Fibonacci åºåˆ—ã€çˆ¬æ¥¼æ¢¯é—®é¢˜ã€‚
- **æœ€ä¼˜å­ç»“æ„**ï¼šè‹¥é—®é¢˜çš„æœ€ä¼˜è§£å¯ç”±å­é—®é¢˜çš„æœ€ä¼˜è§£ç»„æˆï¼Œåˆ™å¯ä»¥é€’æ¨ã€‚ä¾‹æœ€çŸ­è·¯å¾„ã€èƒŒåŒ…é—®é¢˜ã€LCSã€‚
- **å­é—®é¢˜ä¾èµ–å…³ç³»**ï¼šçŠ¶æ€ä¹‹é—´é€šå¸¸æ„æˆä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ã€‚æŒ‰ç…§è¿™ä¸ªä¾èµ–å…³ç³»æ’åºæ±‚è§£ï¼Œå³ä¸º Bottom-Up åŠ¨æ€è§„åˆ’ã€‚
- **DPæœ¬è´¨**ï¼šæ˜¯åœ¨æœç´¢æ ‘ä¸Šâ€œå‰ªæ + ç¼“å­˜â€çš„ç³»ç»ŸåŒ–è¿‡ç¨‹ã€‚
  - Top-Downï¼ˆè®°å¿†åŒ–æœç´¢ï¼‰ï¼šé€’å½’ + ç¼“å­˜ç»“æœã€‚
  - Bottom-Upï¼ˆè¿­ä»£ DPï¼‰ï¼šæŒ‰ä¾èµ–é¡ºåºé€æ­¥å¡«è¡¨ã€‚
     ä¸¤ç§æ–¹å¼ç­‰ä»·ï¼Œåªæ˜¯æ–¹å‘ä¸åŒã€‚

### ğŸ§­ é€‚ç”¨æ¡ä»¶ï¼ˆåˆ¤æ–­æ˜¯å¦èƒ½ç”¨ DPï¼‰

1. **é—®é¢˜å¯åˆ†è§£æˆè§„æ¨¡æ›´å°çš„å­é—®é¢˜**ã€‚
2. **å­é—®é¢˜ä¹‹é—´æœ‰é‡å **ï¼Œè€Œä¸æ˜¯å®Œå…¨ç‹¬ç«‹ï¼ˆå¦åˆ™åˆ†æ²»æ›´ä¼˜ï¼‰ã€‚
3. **æ»¡è¶³æœ€ä¼˜å­ç»“æ„**ï¼šå…¨å±€æœ€ä¼˜ç”±å±€éƒ¨æœ€ä¼˜æ„æˆã€‚
4. **çŠ¶æ€æ•°æœ‰é™ä¸”å¯æšä¸¾**ã€‚
5. **è½¬ç§»æ–¹å‘æ˜ç¡®ï¼ˆæ— ç¯ä¾èµ–ï¼‰**ã€‚

> âœ… å¦‚æœé—®é¢˜æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œå°±å¯ä»¥è€ƒè™‘åŠ¨æ€è§„åˆ’ã€‚

### ğŸ”§ å°ç»“è¦ç‚¹

- DP çš„å…³é”®ä¸æ˜¯â€œèƒ½ä¸èƒ½å†™å‡ºä»£ç â€ï¼Œè€Œæ˜¯æ‰¾å‡º**æ­£ç¡®çš„çŠ¶æ€å®šä¹‰å’Œè½¬ç§»å…³ç³»**ã€‚
- ä¸€æ—¦çŠ¶æ€è®¾è®¡æ­£ç¡®ï¼ŒDP å°±æ˜¯â€œ**è‡ªåŠ¨æ¨ç†æœºå™¨**â€ï¼š
   åªéœ€æŒ‰æ‹“æ‰‘åºå¡«è¡¨å³å¯å¾—åˆ°å…¨å±€æœ€ä¼˜è§£ã€‚

------

## ğŸ§© 2. DP çš„äº”è¦ç´ 

åŠ¨æ€è§„åˆ’çš„å…³é”®åœ¨äºâ€œæ‹†è§£é—®é¢˜ + æœ‰åºé€’æ¨â€ã€‚
 æ— è®ºæ˜¯**çº¿æ€§ DPã€åŒºé—´ DPã€æ ‘ DP è¿˜æ˜¯çŠ¶å‹ DP**ï¼Œéƒ½éµå¾ªåŒæ ·çš„ 5 ä¸ªæ ¸å¿ƒç¯èŠ‚ã€‚

------

### ğŸ§  1ï¸âƒ£ çŠ¶æ€å®šä¹‰ï¼ˆState Definitionï¼‰

> å†³å®šäº†ä½ åœ¨ DP è¡¨ä¸­è®°å½•ä»€ä¹ˆâ€œä¿¡æ¯â€ã€‚

#### ğŸ”¹ åŸåˆ™ï¼š

- æ˜ç¡®â€œ**å­é—®é¢˜æ˜¯ä»€ä¹ˆ**â€ã€‚
- æ¯ä¸ªçŠ¶æ€åº”èƒ½å”¯ä¸€è¡¨ç¤ºä¸€ä¸ªå­é—®é¢˜ã€‚
- å°½é‡è®©çŠ¶æ€â€œæœ€å°ä½†å……è¶³â€â€”â€”å³åˆšå¥½èƒ½æ”¯æ’‘è½¬ç§»ï¼Œä¸å†—ä½™ã€‚

#### ğŸ”¹ ç¤ºä¾‹ï¼š

- çˆ¬æ¥¼æ¢¯ï¼š`f[i] = åˆ°ç¬¬ i é˜¶çš„æ–¹æ¡ˆæ•°`
- èƒŒåŒ…ï¼š`f[i][w] = å¤„ç†å‰ i ä»¶ç‰©å“ï¼Œå®¹é‡ w çš„æœ€å¤§ä»·å€¼`
- LISï¼š`f[i] = ä»¥ç¬¬ i ä¸ªæ•°ç»“å°¾çš„ LIS é•¿åº¦`

------

### âš™ï¸ 2ï¸âƒ£ çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆState Transitionï¼‰

> æè¿°å½“å‰çŠ¶æ€å¦‚ä½•ç”±æ›´å°çš„çŠ¶æ€å¾—åˆ°ã€‚

#### ğŸ”¹ ä¸€èˆ¬å½¢å¼ï¼š

```
f[i] = best( f[å‰ç½®çŠ¶æ€] + å½“å‰å†³ç­–çš„ä»£ä»· )
```

#### ğŸ”¹ æ€ç»´è·¯å¾„ï¼š

1. ä»**æœ€ç»ˆç›®æ ‡**é€†æ¨éœ€è¦å“ªäº›å­é—®é¢˜ï¼›
2. å¯¹æ¯ä¸ªçŠ¶æ€ï¼Œ**æšä¸¾æ‰€æœ‰å¯èƒ½çš„å‰é©±**ï¼›
3. å–æœ€ä¼˜ / æ±‚å’Œ / è®¡æ•°ç­‰æ“ä½œã€‚

#### ğŸ”¹ ç¤ºä¾‹ï¼š

- **çˆ¬æ¥¼æ¢¯**ï¼š`f[i] = f[i-1] + f[i-2]`

- **0-1 èƒŒåŒ…**ï¼š`f[i][w] = max(f[i-1][w], f[i-1][w-weight[i]] + value[i])`

- **LCS(æœ€é•¿å…¬å…±å­åºåˆ—)**ï¼š

  ```c++
  if s1[i]==s2[j]: f[i][j]=f[i-1][j-1]+1
  else: f[i][j]=max(f[i-1][j], f[i][j-1])
  ```

------

### ğŸ§± 3ï¸âƒ£ è¾¹ç•Œåˆå§‹åŒ–ï¼ˆBoundary Initializationï¼‰

> å†³å®šé€’æ¨çš„èµ·ç‚¹ï¼Œä¹Ÿå¸¸æ˜¯ Bug é›†ä¸­åŒºã€‚

#### ğŸ”¹ åŸåˆ™ï¼š

- å¯¹äºæ— æ³•è½¬ç§»åˆ°çš„çŠ¶æ€ï¼ˆä¾‹å¦‚ç©ºé›†ã€ç©ºåŒºé—´ã€å®¹é‡ä¸º 0ï¼‰ï¼Œå¿…é¡»èµ‹æ˜ç¡®åˆå€¼ã€‚
- è‹¥æ±‚æœ€å¤§å€¼å‹ï¼šåˆå§‹åŒ–çŠ¶æ€è®¾ä¸º `-inf`ï¼›
   è‹¥æ±‚æœ€å°å€¼å‹ï¼šåˆå§‹åŒ–çŠ¶æ€è®¾ä¸º `+inf`ã€‚

#### ğŸ”¹ ç¤ºä¾‹ï¼š

- èƒŒåŒ…ï¼š`f[0][w]=0`
- LCSï¼š`f[0][j]=f[i][0]=0`
- Fibonacciï¼š`f[1]=1, f[2]=2`

------

### ğŸ”„ 4ï¸âƒ£ è®¡ç®—é¡ºåºï¼ˆComputation Orderï¼‰

> å³æŒ‰ä¾èµ–æ‹“æ‰‘åºè®¡ç®—ï¼Œä¿è¯æ¯ä¸ªçŠ¶æ€åœ¨ä½¿ç”¨å‰å·²çŸ¥ã€‚

#### ğŸ”¹ å¸¸è§é¡ºåºï¼š

| DP ç±»å‹      | é¡ºåº                      |
| ------------ | ------------------------- |
| çº¿æ€§ DP      | i ä»å°åˆ°å¤§                |
| èƒŒåŒ…ï¼ˆ0-1ï¼‰  | i æ­£åºï¼Œw å€’åº            |
| èƒŒåŒ…ï¼ˆå®Œå…¨ï¼‰ | i æ­£åºï¼Œw æ­£åº            |
| åŒºé—´ DP      | æŒ‰åŒºé—´é•¿åº¦ len ä»å°åˆ°å¤§   |
| æ ‘å½¢ DP      | DFS ååºéå†              |
| DAG DP       | æ‹“æ‰‘æ’åº                  |
| æ•°ä½ DP      | é«˜ä½ â†’ ä½ä½ï¼ˆé€’å½’è®°å¿†åŒ–ï¼‰ |

**å†™æ³•æ¨¡æ¿**ï¼ˆè‡ªåº•å‘ä¸Šï¼‰ï¼š

```C++
# åˆå§‹åŒ–
f = [è´Ÿæ— ç©·æˆ–0] * (n+1)
f[0] = åˆå§‹å€¼

# æŒ‰ä¾èµ–é¡ºåºé€’æ¨
for i in range(1, n+1):
    for d in æ‰€æœ‰å¯èƒ½çš„å†³ç­–:
        f[i] = best(f[i], trans(f[å‰ç½®çŠ¶æ€], d))

# è¾“å‡ºç­”æ¡ˆ
print(f[n] æˆ– max(f))
```

------

## ğŸ§© 3. ç»å…¸æ¨¡å‹ Iï¼šåºåˆ— DP

### 3.1 æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼ˆLISï¼‰& æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰

ç»™å®šä¸€ä¸ªåºåˆ— `a_1, a_2, ..., a_n`ï¼Œæ±‚å…¶ä¸­æœ€é•¿çš„ **ä¸¥æ ¼é€’å¢å­åºåˆ—** çš„é•¿åº¦ã€‚

```c++
è¾“å…¥:
8
10 9 2 5 3 7 101 18
è¾“å‡º:
4
```

- çŠ¶æ€ï¼š`dp[i] = ä»¥ a[i] ç»“å°¾çš„ LIS é•¿åº¦`
- è½¬ç§»æ–¹ç¨‹ï¼š`dp[i] = 1 + max{ dp[j] | j<i ä¸” a[j]<a[i] }`

ğŸ“Œ **ä¸€ã€DP ç‰ˆï¼ˆO(nÂ²)ï¼‰**

```c++
#include <bits/stdc++.h>
using namespace std;
// æ±‚æœ€é•¿ä¸Šå‡å­åºåˆ—é•¿åº¦ â€”â€” O(n^2) åŠ¨æ€è§„åˆ’å†™æ³•
int main() {
    int n;
    cin >> n;
    vector<int> a(n);
    for (int i = 0; i < n; i++) cin >> a[i];
    vector<int> dp(n, 1); // dp[i] = ä»¥ a[i] ç»“å°¾çš„ LIS é•¿åº¦
    int ans = 1;
    for (int i = 0; i < n; i++) {
        for (int j = 0; j < i; j++) {
            if (a[j] < a[i]) {              // åªæœ‰æ¯”å½“å‰å°çš„æ•°æ‰èƒ½æ¥åœ¨å‰é¢
                dp[i] = max(dp[i], dp[j] + 1);
            }
        }
        ans = max(ans, dp[i]);              // è®°å½•å…¨å±€æœ€é•¿é•¿åº¦
    }
    cout << ans << endl;
    return 0;
}
```

##### ğŸ“Œ äºŒã€äºŒåˆ†ä¼˜åŒ–ç‰ˆï¼ˆO(n log n)ï¼‰

```c++
#include <bits/stdc++.h>
using namespace std;
// æ±‚æœ€é•¿ä¸Šå‡å­åºåˆ—é•¿åº¦ â€”â€” O(n log n) äºŒåˆ†ä¼˜åŒ–å†™æ³•
int main() {
    int n;
    cin >> n;
    vector<int> a(n);
    for (int i = 0; i < n; i++) cin >> a[i];
    vector<int> tails;  // tails[k] = é•¿åº¦ä¸º k+1 çš„ä¸Šå‡å­åºåˆ—çš„æœ€å°ç»“å°¾å€¼
    for (int x : a) { // lower_bound æŸ¥æ‰¾ç¬¬ä¸€ä¸ª â‰¥ x çš„ä½ç½®
        auto it = lower_bound(tails.begin(), tails.end(), x);
        if (it == tails.end())
            tails.push_back(x);     // å¦‚æœ x æ¯”æ‰€æœ‰ç»“å°¾éƒ½å¤§ï¼Œå»¶é•¿åºåˆ—
        else
            *it = x;                // å¦åˆ™æ›¿æ¢ï¼ˆæ›´ä¼˜çš„ç»“å°¾ï¼‰
    }
    cout << tails.size() << endl;
    return 0;
}
```

### ğŸ§© ä»€ä¹ˆæ˜¯ LCSï¼Ÿ

ç»™å®šA = "ACDBE"ï¼ŒB = "ABCDE"ï¼Œæœ€é•¿çš„å…¬å…±å­åºåˆ—æ˜¯ `"ACDE"`ï¼ŒLCS(A, B) é•¿åº¦ä¸º **4**ã€‚

### ğŸ§  çŠ¶æ€å®šä¹‰

```
f[i][j] = A[1..i] ä¸ B[1..j] çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦
```

### âœ… è½¬ç§»æ–¹ç¨‹

```c++
if (A[i] == B[j]):
    f[i][j] = f[i-1][j-1] + 1
else:
    f[i][j] = max(f[i-1][j], f[i][j-1])
```

- è‹¥æœ«å°¾å­—ç¬¦ç›¸ç­‰ â†’ å¯ä»¥å»¶é•¿å…¬å…±å­åºåˆ—ï¼›
- è‹¥ä¸ç›¸ç­‰ â†’ å¿…é¡»èˆå¼ƒ A[i] æˆ– B[j] ä¸­çš„ä¸€ä¸ªï¼Œå–è¾ƒä¼˜è§£ã€‚

### ğŸ§± è¾¹ç•Œæ¡ä»¶ï¼š

```c++
f[0][*] = 0
f[*][0] = 0 //ï¼ˆç©ºä¸²ä¸ä»»ä½•å­—ç¬¦ä¸²çš„ LCS ä¸º 0ï¼‰
```

```c++
#include <bits/stdc++.h>
using namespace std;
int main() {
    string A, B;
    cin >> A >> B;
    int n = A.size(), m = B.size();
    vector<vector<int>> dp(n + 1, vector<int>(m + 1, 0));
    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= m; j++) {
            if (A[i - 1] == B[j - 1])
                dp[i][j] = dp[i - 1][j - 1] + 1;
            else
                dp[i][j] = max(dp[i - 1][j], dp[i][j - 1]);
        }
    }
    cout << "LCS length = " << dp[n][m] << endl;
    return 0;
}
```

### 3.2 å­åºåˆ—è®¡æ•° & ç¼–è¾‘è·ç¦»

###### âœ… Case 1ï¼šç»Ÿè®¡ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­åºåˆ—å‡ºç°æ¬¡æ•°

**ä¾‹é¢˜ï¼š** S = `"babgbag"` T = `"bag"`,é—® T åœ¨ S ä¸­ä½œä¸ºå­åºåˆ—çš„å‡ºç°æ¬¡æ•°ã€‚

### ğŸ§  çŠ¶æ€å®šä¹‰ï¼š

```
f[i][j] = S çš„å‰ i ä¸ªå­—ç¬¦ä¸­ï¼ŒT çš„å‰ j ä¸ªå­—ç¬¦å‡ºç°ä¸ºå­åºåˆ—çš„æ¬¡æ•°
```

### âš™ï¸ è½¬ç§»æ–¹ç¨‹ï¼š

```
if S[i] == T[j]:
    f[i][j] = f[i-1][j-1] + f[i-1][j]
else:
    f[i][j] = f[i-1][j]
```

- å½“å­—ç¬¦ç›¸ç­‰ï¼šå¯é€‰æ‹©â€œåŒ¹é…â€æˆ–â€œè·³è¿‡â€ï¼›
- å½“å­—ç¬¦ä¸ç­‰ï¼šåªèƒ½è·³è¿‡ S[i]ã€‚

### ğŸ§± åˆå§‹åŒ–ï¼š

- `f[i][0] = 1` ï¼ˆç©ºä¸²æ˜¯ä»»ä½•å­—ç¬¦ä¸²çš„å­åºåˆ—ï¼‰
- `f[0][j>0] = 0`

```c++
int numDistinct(string s, string t) {
    int n = s.size(), m = t.size();
    vector<vector<long long>> dp(n + 1, vector<long long>(m + 1, 0));
    for (int i = 0; i <= n; i++) dp[i][0] = 1; // ç©ºä¸²å­åºåˆ—

    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= m; j++) {
            dp[i][j] = dp[i-1][j];
            if (s[i-1] == t[j-1]) dp[i][j] += dp[i-1][j-1];
        }
    }
    return dp[n][m];
}
```

###### âœ… Case 2ï¼šç»Ÿè®¡ä¸åŒå­åºåˆ—ä¸ªæ•°

**é¢˜æ„ï¼š**ç»™å®šå­—ç¬¦ä¸² Sï¼Œæ±‚å®ƒæœ‰å¤šå°‘ä¸ªä¸åŒçš„å­åºåˆ—ã€‚

ä¾‹å¦‚ï¼šS = `"abc"` â†’ å­åºåˆ—ï¼š`a,b,c,ab,ac,bc,abc` + ç©ºä¸² = 8

**DP æ€è·¯ï¼š**

- `f[i]` = å‰ i ä¸ªå­—ç¬¦èƒ½ç»„æˆçš„ä¸åŒå­åºåˆ—æ•°ã€‚

- è‹¥å½“å‰å­—ç¬¦ `S[i]` é¦–æ¬¡å‡ºç°ï¼Œåˆ™ï¼š

  ```
  f[i] = 2 * f[i-1]
  ```

- è‹¥ `S[i]` æ›¾å‡ºç°è¿‡ï¼Œåˆ™å‡å»é‡å¤è´¡çŒ®ï¼š

  ```
  f[i] = 2 * f[i-1] - f[last[S[i]] - 1]
  ```

### ğŸ’» C++ æ¨¡æ¿ï¼š

```c++
int distinctSubseq(string s) {
    int n = s.size(), mod = 1e9+7;
    vector<long long> dp(n + 1);
    vector<int> last(256, -1);
    dp[0] = 1; // ç©ºä¸²
    for (int i = 1; i <= n; i++) {
        dp[i] = (2 * dp[i - 1]) % mod;
        if (last[s[i - 1]] != -1)
            dp[i] = (dp[i] - dp[last[s[i - 1]] - 1] + mod) % mod;
        last[s[i - 1]] = i;
    }
    return (dp[n] - 1 + mod) % mod; //å‡å»ç©ºä¸²
}
```

###### âœ… Case 3ï¼šç»å…¸æœ€çŸ­ç¼–è¾‘è·ç¦»ï¼ˆLevenshtein Distanceï¼‰

é¢˜æ„ï¼šæœ€å°‘éœ€è¦å¤šå°‘æ¬¡æ’å…¥ / åˆ é™¤ / æ›¿æ¢æ“ä½œï¼ŒæŠŠå­—ç¬¦ä¸² A å˜æˆ Bã€‚

ä¾‹å¦‚ï¼šA = `"horse"`, B = `"ros"`
 è¾“å‡ºï¼š`3`
 ï¼ˆæ“ä½œï¼š`horse â†’ rorse â†’ rose â†’ ros`ï¼‰

### ğŸ§  çŠ¶æ€å®šä¹‰ï¼š

```c++
f[i][j] = æŠŠ A[1..i] å˜æˆ B[1..j] çš„æœ€å°ç¼–è¾‘æ¬¡æ•°
```

### âš™ï¸ è½¬ç§»æ–¹ç¨‹ï¼š

```c++
if A[i] == B[j]:
    f[i][j] = f[i-1][j-1]
else:
    f[i][j] = min(
        f[i-1][j] + 1,     // åˆ é™¤ A[i]
        f[i][j-1] + 1,     // æ’å…¥ B[j]
        f[i-1][j-1] + 1    // æ›¿æ¢
    )
```

### ğŸ§± è¾¹ç•Œæ¡ä»¶ï¼š

```c++
f[0][j] = j  // æŠŠç©ºä¸²å˜æˆå‰ j ä¸ªå­—ç¬¦ï¼ˆå…¨æ’å…¥ï¼‰
f[i][0] = i  // æŠŠå‰ i ä¸ªå­—ç¬¦åˆ å…‰
```

### ğŸ’» C++ æ¨¡æ¿ï¼š

```c++
int minDistance(string a, string b) {
    int n = a.size(), m = b.size();
    vector<vector<int>> dp(n + 1, vector<int>(m + 1, 0));

    for (int i = 0; i <= n; i++) dp[i][0] = i;
    for (int j = 0; j <= m; j++) dp[0][j] = j;

    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= m; j++) {
            if (a[i - 1] == b[j - 1])
                dp[i][j] = dp[i - 1][j - 1];
            else
                dp[i][j] = 1 + min({dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1]});
        }
    }
    return dp[n][m];
}
```

### 3.3 åˆ†ç»„ä¸å‰ç¼€ä¼˜åŒ–ï¼ˆGrouped DP & Prefix Optimizationï¼‰

è¿™ç±»é¢˜çš„å…±åŒç‰¹å¾æ˜¯ï¼š

> è½¬ç§»å½¢å¦‚
> $$
> f[i] = \min_{j<i}(f[j] + \text{cost}(j+1, i))
> $$
> æˆ–æœ‰åˆ†ç»„ã€åˆ†æ®µã€åˆ’åˆ†ç­‰ç»“æ„ã€‚

### ğŸ§© ä¸€ã€åˆ†ç»„ DPï¼ˆGrouped / Partition DPï¼‰

### ğŸ§  æ¦‚å¿µ

å½“é—®é¢˜è¦æ±‚å°†åºåˆ—æˆ–é›†åˆ**åˆ’åˆ†æˆè‹¥å¹²ç»„**ã€**è‹¥å¹²æ®µ**æ—¶ï¼Œå°±å¯ä»¥ç”¨åˆ†ç»„ DPã€‚
 å¸¸è§è½¬ç§»å¼ï¼š
$$
f[i][k] = \min_{j < i} (f[j][k-1] + \text{cost}(j+1, i))
$$
æ„æ€æ˜¯ï¼š

> æŠŠå‰ i ä¸ªå…ƒç´ åˆ’æˆ k æ®µæ—¶ï¼Œæœ€åä¸€æ®µæ˜¯ (j+1..i)ã€‚

------

### âœ… case 1ï¼šåˆ†å‰²æ•°ç»„çš„æœ€å°ä»£ä»·

**é¢˜æ„ï¼š**
 ç»™å®šåºåˆ— `a[1..n]`ï¼ŒæŠŠå®ƒåˆ’åˆ†ä¸º k æ®µï¼Œä½¿å¾—æ¯æ®µçš„â€œå¹³æ–¹å’Œâ€æˆ–â€œæ–¹å·®â€æœ€å°ã€‚

```C++
a = [1, 2, 3, 4], k = 2
å¯ä»¥åˆ†æˆ [1,2,3] | [4]
ä»£ä»· = (1+2+3)^2 + (4)^2 = 36 + 16 = 52
```

##### ğŸ§  çŠ¶æ€è®¾è®¡

- `dp[i][t]` = å°†å‰ `i` ä¸ªæ•°åˆ’æˆ `t` æ®µçš„æœ€å°ä»£ä»·
- `cost(l, r)` = `(prefix[r] - prefix[l-1])^2`

**è½¬ç§»æ–¹ç¨‹ï¼š**
$$
dp[i][t] = \min_{j < i} (dp[j][t-1] + cost(j+1, i))
$$
é€šè¿‡ å‰ç¼€å’Œæ•°ç»„ å¯åœ¨ O(1) æ—¶é—´è®¡ç®— costã€‚

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int n, k;
    cin >> n >> k;
    vector<ll> a(n + 1), prefix(n + 1);
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
        prefix[i] = prefix[i - 1] + a[i];
    }
    const ll INF = 1e18;
    vector<vector<ll>> dp(k + 1, vector<ll>(n + 1, INF));
    dp[0][0] = 0;
    // è®¡ç®— cost(j+1, i)
    auto cost = [&](int l, int r) {
        ll sum = prefix[r] - prefix[l - 1];
        return sum * sum;
    };
    for (int t = 1; t <= k; t++) {          // åˆ†æ®µæ•°
        for (int i = 1; i <= n; i++) {      // å‰ i ä¸ªå…ƒç´ 
            for (int j = 0; j < i; j++) {   // ä¸Šä¸€ä¸ªåˆ†å‰²ç‚¹
                dp[t][i] = min(dp[t][i], dp[t - 1][j] + cost(j + 1, i));
            }
        }
    }
    cout << dp[k][n] << "\n";
    return 0;
}
```

### âœ… case 2ï¼šUSACO Gold é¢˜ â€œCow Poetryâ€ï¼ˆ2019å¹´2æœˆï¼‰

å°†è‹¥å¹²å•è¯åˆ†ç»„å½¢æˆæŠ¼éŸµè¯—è¡Œã€‚
 è½¬ç§»ç±»ä¼¼ï¼š

```
dp[i] = âˆ‘ dp[j] ï¼ˆè‹¥ j åˆ° i çš„ syllable sum == Kï¼‰
```

è¿™æ˜¯åˆ†ç»„ DP + æ¨¡æ¿åŒ¹é…é—®é¢˜ã€‚

------

### âœ… case 3ï¼šæœ€ä¼˜åˆ†å‰²é—®é¢˜ï¼ˆOptimal Partition / K Segmentsï¼‰

> LeetCode 410. Split Array Largest Sum
>  ç»™å®šæ•°ç»„ï¼Œå°†å…¶åˆ†æˆ m æ®µï¼Œä½¿æ¯æ®µå’Œçš„æœ€å¤§å€¼æœ€å°ã€‚

è™½ç„¶å¸¸ç”¨äºŒåˆ†+è´ªå¿ƒæ±‚è§£ï¼Œä¹Ÿå¯ç”¨åˆ†ç»„ DPï¼š

```
dp[i][k] = min_{j<i} max(dp[j][k-1], sum(j+1, i))
```

------

### âœ… case 4ï¼šæ‰“åŒ…ä¸ä»»åŠ¡è°ƒåº¦ï¼ˆåˆ†ç»„èƒŒåŒ…ç±»ï¼‰

> æœ‰ N ä¸ªä»»åŠ¡åˆ†æˆè‹¥å¹²ç»„ï¼Œæ¯ç»„å†…åªèƒ½é€‰ä¸€ä¸ªä»»åŠ¡ã€‚
>  æ¯ç»„ç›¸å½“äºä¸€ä¸ªâ€œç»„å†…èƒŒåŒ…â€ï¼Œè¿™å°±æ˜¯â€œåˆ†ç»„èƒŒåŒ… DPâ€ã€‚

```
for each group g:
    for w = W .. 0:
        for each item i in group g:
            dp[w] = max(dp[w], dp[w - weight[i]] + value[i])
```

### ğŸ“˜ äºŒã€å‰ç¼€ä¼˜åŒ–ï¼ˆPrefix / Convex Optimizationï¼‰

### ğŸ§  æ¦‚å¿µ

å½“è½¬ç§»å½¢å¦‚
$$
f[i] = \min_{j < i} (f[j] + C(j, i))
$$
å¹¶ä¸” `C(j, i)` æ»¡è¶³**å•è°ƒæ€§**æˆ–**å‡¸æ€§**æ—¶ï¼Œå¯ä»¥åˆ©ç”¨**å‰ç¼€æœ€ä¼˜å†³ç­–**è¿›è¡Œä¼˜åŒ–ã€‚

æ ¸å¿ƒæ€æƒ³ï¼š

- ç”¨â€œå†³ç­–ç‚¹å•è°ƒæ€§â€ä¼˜åŒ–æšä¸¾ï¼›
- æˆ–ç”¨å‰ç¼€æœ€å°å€¼æ•°ç»„ã€å•è°ƒé˜Ÿåˆ—ã€æ–œç‡ä¼˜åŒ–ï¼ˆCHTï¼‰æ¥åŠ é€Ÿã€‚

### âœ… case 1ï¼šå‰ç¼€æœ€å°å€¼ä¼˜åŒ–ï¼ˆPrefix Minï¼‰

> **é¢˜å‹ï¼š**
>  å½¢å¦‚ `f[i] = min_{j < i} (f[j] + cost[j])` ä¸” `cost[j]` å•è°ƒã€‚

å¯ä»¥ç»´æŠ¤ä¸€ä¸ªæ»šåŠ¨å‰ç¼€æœ€å°å€¼ï¼š

```c++
min_pref = INF;
for (int i = 1; i <= n; i++) {
    f[i] = min_pref + cost[i];
    min_pref = min(min_pref, f[i] - something[i]);
}
```

**ä¾‹é¢˜ï¼š**USACO â€œRental Serviceâ€ æˆ– â€œLoan Repaymentâ€ ä¸­çš„æ”¶ç›Šæœ€å¤§åŒ–é—®é¢˜ã€‚

### âœ… case 2ï¼šå†³ç­–å•è°ƒæ€§ä¼˜åŒ–ï¼ˆDivide & Conquer Optimizationï¼‰

æˆ‘ä»¬è€ƒè™‘ä¸€ç±» DPï¼š
$$
f[i] = \min_{j < i} \{ f[j] + w(j, i) \}
$$
è¿™ç§ DP æœ´ç´ æ˜¯ **O(nÂ²)**ï¼Œå› ä¸ºæ¯ä¸ª i éƒ½è¦æšä¸¾æ‰€æœ‰ jã€‚
 å¦‚æœâ€œæœ€ä¼˜å†³ç­–ç‚¹ï¼ˆopt[i]ï¼‰â€ æ»¡è¶³å•è°ƒæ€§ï¼š
$$
opt[i-1] \le opt[i]
$$
é‚£æˆ‘ä»¬å°±å¯ä»¥ç”¨ **åˆ†æ²»ç®—æ³•** ä¼˜åŒ–è½¬ç§»è¿‡ç¨‹ï¼Œä»è€ŒæŠŠå¤æ‚åº¦é™åˆ° **O(n log n)**ã€‚

ğŸ§©å‡è®¾æˆ‘ä»¬è¦æŠŠæ•°ç»„ `a = [1, 2, 3, 4, 5]` åˆ†æˆä¸¤æ®µï¼Œä½¿å¾—æ¯æ®µçš„ä»£ä»·æ˜¯**åŒºé—´å’Œçš„å¹³æ–¹**ï¼š
$$
dp[i] = \min_{j<i} \big(dp[j] + (sum[i]-sum[j])^2\big)
$$
ä»£ä»·å‡½æ•°ï¼š
$$
cost(j+1, i) = (prefix[i] - prefix[j])^2
$$

```c++
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

int main() {
    int n = 5;
    vector<ll> a = {0, 1, 2, 3, 4, 5};
    vector<ll> prefix(6);
    for (int i = 1; i <= n; i++) prefix[i] = prefix[i - 1] + a[i];

    auto cost = [&](int l, int r) {
        ll s = prefix[r] - prefix[l - 1];
        return s * s;
    };

    vector<ll> dp(n + 1, 1e18);
    vector<int> opt(n + 1, 0);
    dp[0] = 0;

    for (int i = 1; i <= n; i++) {
        int start = opt[i - 1];   // ä»ä¸Šä¸€ä¸ªæœ€ä¼˜ç‚¹å¼€å§‹
        for (int j = start; j < i; j++) {
            ll val = dp[j] + cost(j + 1, i);
            if (val < dp[i]) {
                dp[i] = val;
                opt[i] = j;
            }
        }
    }

    for (int i = 1; i <= n; i++)
        cout << "i=" << i << " dp=" << dp[i] << " opt=" << opt[i] << "\n";
}

```

### **ä¾‹é¢˜ï¼š**

- USACO Gold â€œArray Partitionâ€
- POJ 1180 â€œBatch Processingâ€

------

### âœ… ä¾‹ 3ï¼šæ–œç‡ä¼˜åŒ–ï¼ˆConvex Hull Trick, CHTï¼‰

> å½“è½¬ç§»å½¢å¦‚ï¼š
> $$
> f[i] = \min_{j<i} (f[j] + m_j \times x_i + b_j)
> $$
> å¯ç”¨â€œå‡¸åŒ…â€ç»´æŠ¤æœ€ä¼˜å†³ç­–ã€‚

**åº”ç”¨ï¼š**

- æ•°ç»„åˆ†æ®µæœ€å°å¹³æ–¹è¯¯å·®ï¼ˆæ‹Ÿåˆé—®é¢˜ï¼‰
- â€œæ»‘åŠ¨çª—å£ + çº¿æ€§ DPâ€ é—®é¢˜ï¼ˆå¦‚â€œChorus Lineâ€, â€œLine Fittingâ€ï¼‰

------

### âœ… ä¾‹ 4ï¼šå•è°ƒé˜Ÿåˆ—ä¼˜åŒ–ï¼ˆMonotone Queue DPï¼‰

> è½¬ç§»ä¸­å¸¦æœ‰é™çª—å£ï¼š
> $$
> f[i] = \min_{j \in [i-L, i-1]} (f[j] + cost(j, i))
> $$
> å¯ç”¨åŒç«¯é˜Ÿåˆ—ç»´æŠ¤æœ€ä¼˜ `j`ã€‚

**ä¾‹é¢˜ï¼š**

- USACO â€œCow Jogâ€
- LeetCode 1696 â€œJump Game VIâ€

------

### âœ… ä¾‹ 5ï¼šKnuth ä¼˜åŒ–ï¼ˆå››è¾¹å½¢ä¸ç­‰å¼ï¼‰

> å½“ DP å½¢å¦‚åŒºé—´åˆå¹¶ï¼š
> $$
> f[l][r] = \min_{k\in(l,r)} (f[l][k] + f[k+1][r] + w(l, r))
> $$
> ä¸”æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼æ—¶ï¼Œå¯ä¼˜åŒ–ä¸º O(nÂ²)ã€‚

**ä¾‹é¢˜ï¼š**

- çŸ³å­åˆå¹¶ï¼ˆMerge Stonesï¼‰
- æœ€ä¼˜äºŒå‰æœç´¢æ ‘ï¼ˆOptimal BSTï¼‰

------

### âš™ï¸ ä¸‰ã€å¸¸è§è½¬ç§»å½¢å¼æ€»è¡¨

| DP ç±»å‹        | è½¬ç§»å½¢å¼                                       | å…¸å‹ä¼˜åŒ–          | å¸¸è§é¢˜ç›®         |
| -------------- | ---------------------------------------------- | ----------------- | ---------------- |
| åˆ†æ®µåˆ’åˆ†       | `f[i][k] = min_j f[j][k-1] + cost(j+1,i)`      | å†³ç­–å•è°ƒæ€§ / åˆ†æ²» | æ•°ç»„åˆ†æ®µæœ€å°ä»£ä»· |
| åŒºé—´åˆå¹¶       | `f[l][r] = min_k f[l][k] + f[k+1][r] + w(l,r)` | Knuth ä¼˜åŒ–        | çŸ³å­åˆå¹¶         |
| çº¿æ€§å¼         | `f[i] = min_j (f[j] + m_j*x_i + b_j)`          | æ–œç‡ä¼˜åŒ–ï¼ˆCHTï¼‰   | Line Fitting     |
| æ»‘åŠ¨çª—å£       | `f[i] = min_{jâˆˆ[i-L,i-1]} (...)`               | å•è°ƒé˜Ÿåˆ—          | Jump Game VI     |
| ç®€å•å‰ç¼€æœ€å°å€¼ | `f[i] = min_j (f[j] + c[j])`                   | å‰ç¼€ä¼˜åŒ–          | æœ€å¤§å­æ®µå’Œå˜ä½“   |

------

### ğŸ§  å››ã€å¯è§†åŒ–ç†è§£

å¯ä»¥æŠŠ â€œf[i] = min(f[j] + cost(j,i))â€ ç†è§£ä¸ºï¼š

> ä»çŠ¶æ€ j å‘ i è¿ä¸€æ¡è¾¹ï¼Œä»£ä»·æ˜¯ cost(j,i)ï¼Œ
>  DP å°±æ˜¯æ±‚ä¸€æ¡æœ€çŸ­è·¯å¾„ã€‚

å¦‚æœ cost æ»¡è¶³å•è°ƒæ€§ï¼ˆå¦‚ j è¶Šå¤§è¶Šä¸ä¼˜ï¼‰ï¼Œ
 é‚£æˆ‘ä»¬å¯ä»¥ç”¨å„ç§å‡ ä½•æˆ–æ•°æ®ç»“æ„ä¼˜åŒ–ï¼ˆå‡¸åŒ…ã€é˜Ÿåˆ—ã€å‰ç¼€æœ€å°ç­‰ï¼‰ã€‚

------

### ğŸ“˜ äº”ã€ç»ƒä¹ é¢˜æ¨èï¼ˆéš¾åº¦é€’å¢ï¼‰

| ç±»å‹       | é¢˜ç›®                            | æ¥æº                       |
| ---------- | ------------------------------- | -------------------------- |
| åˆ†ç»„ DP    | Split Array Largest Sum         | LeetCode 410               |
| åˆ†ç»„ DP    | Partition Array for Maximum Sum | LeetCode 1043              |
| å‰ç¼€ä¼˜åŒ–   | Minimum Cost For Tickets        | LeetCode 983               |
| å†³ç­–å•è°ƒæ€§ | Batch Processing                | POJ 1180                   |
| Knuth ä¼˜åŒ– | Merge Stones                    | LeetCode 1000 / USACO Gold |
| æ–œç‡ä¼˜åŒ–   | Line Fitting                    | æ´›è°· P3628                 |
| å•è°ƒé˜Ÿåˆ—   | Jump Game VI                    | LeetCode 1696              |
