## USACO 2025 January Contest, Silver

### Problem 1. Cow Checkups

### ğŸ§© é¢˜æ„ï¼šç»„åˆè®¡æ•° / åŒºé—´æšä¸¾ä¼˜åŒ–

æ€è·¯ï¼š**ä¸€æ¬¡åè½¬åŒºé—´åï¼ŒåŒ¹é… `a_{p(i)}=b_i` çš„æ€»æ¬¡æ•°ï¼Œç´¯åŠ æ‰€æœ‰ `[l,r]`**ã€‚

- `A[j]`ï¼šåŸé˜Ÿåˆ—ç¬¬ `j` å¤´ç‰›çš„ç§ç±»ï¼›

- `B[i]`ï¼šåŒ»ç”Ÿå¸Œæœ›ç¬¬ `i` ä¸ªä½ç½®æ£€æŸ¥çš„ç§ç±»ï¼›

- åè½¬ä¸€æ®µ `[l,r]` åï¼Œç¬¬ `i` ä¸ªä½ç½®æ¥è‡ª
  $$
  p(i)=\begin{cases}
  i,& i\notin[l,r]\\
  l+r-i,& i\in[l,r].
  \end{cases}
  $$

å¯¹æ¯å¯¹ä½ç½® `(j,i)`ï¼ˆåŸæ•°ç»„ä½ç½® `j`ï¼Œç›®æ ‡ä½ç½® `i`ï¼‰ï¼Œå½“ä¸”ä»…å½“ `a_j=b_i` æ—¶ï¼Œè¿™å¯¹ `(j,i)` ä¼šè¢«æŸäº›åŒºé—´ `[l,r]` æŠŠ `j` æ”¾åˆ° `i`ã€‚æŠŠè¿™äº›åŒºé—´ä¸ªæ•°æ±‚å‡ºæ¥å¹¶ç›¸åŠ ï¼Œå°±æ˜¯ç­”æ¡ˆã€‚
$$
\sum_{j=1}^N\sum_{i=1}^N [A_j=B_i]\cdot \textsf{cnt}(j,i).
$$
cnt(j,i) åˆ†ä¸¤ç±»ï¼š

- **ä¸å« j** çš„æ®µï¼šåªåœ¨ i=j æ—¶è®¡æ•°ï¼Œæ•°é‡ä¸º
  $$
  \underbrace{\binom{j}{2}+\binom{N-j-1}{2}}_{\text{å®Œå…¨åœ¨å·¦/å³}}+\underbrace{\min(j,\,N-j-1)+1}_{\text{ä»¥ \(i\) ä¸ºä¸­å¿ƒçš„å¯¹ç§°æ®µ}}.
  $$
  è¿™æ­£æ˜¯ä»£ç é‡Œå½“ `A[i]=B[i]` æ—¶çš„é‚£ä¸€è¡Œï¼ˆ0-based å†™æˆ `ways2(i)+ways2(N-1-i)+min(i,N-1-i)+1`ï¼‰ã€‚

  > å½“æˆ‘ä»¬æŠŠåŒºé—´ `[l,r]` åè½¬æ—¶ï¼Œä½ç½® `i` çš„å…ƒç´ ä¼šå»åˆ°ä½ç½® `p(i)=l+r-i`ã€‚
  >  è¦è®©åè½¬å**ä»ç„¶åœ¨ä½ç½® `i`**ï¼ˆä¹Ÿå°±æ˜¯ `p(i)=i`ï¼‰ï¼Œå¿…é¡»æ»¡è¶³
  > $$
  > l+r=2i.
  > $$
  > è¿™ç±»åŒºé—´å°±æ˜¯â€œ**ä»¥ `i` ä¸ºä¸­å¿ƒçš„å¯¹ç§°æ®µ**â€ï¼šå·¦å³ç«¯ç‚¹åˆ° `i` çš„è·ç¦»ç›¸ç­‰ï¼Œå³å½¢å¦‚
  > $$
  > [l,r]=[\,i-k,\ i+k\,],\quad k\ge 0.
  > $$
  > å®ƒä»¬çš„é•¿åº¦éƒ½æ˜¯å¥‡æ•°ï¼ˆ`2k+1`ï¼‰ï¼ŒçœŸæ­£å¯¹ç§°åœ°â€œç»•ç€ `i`â€ç¿»è½¬ï¼Œç¿»å®Œ `i` ä½ç½®çš„å…ƒç´ æ²¡æœ‰å˜ä½ç½®ã€‚
  >
  > ### æœ‰å¤šå°‘ä¸ªè¿™æ ·çš„å¯¹ç§°æ®µï¼Ÿ
  >
  > å—æ•°ç»„è¾¹ç•Œé™åˆ¶ï¼Œ`k` æœ€å¤§ä¸èƒ½è¶…è¿‡å·¦è¾¹å¯ä¼¸å‡ºçš„ `i` å’Œå³è¾¹å¯ä¼¸å‡ºçš„ `N-1-i`ï¼ˆ0 ä¸‹æ ‡ï¼‰ã€‚
  >  æ‰€ä»¥
  > $$
  > k=0,1,\dots,\min\big(i,\ N-1-i\big),
  > $$
  > **ä¸ªæ•° = **min(i,Nâˆ’1âˆ’i)+1**ã€‚
  >
  > - **0-based ç´¢å¼•**ï¼šä¸ªæ•° min(i,Nâˆ’1âˆ’i)+1ã€‚
  > - **1-based ç´¢å¼•**ï¼ˆä½ç½®ä» 1 åˆ° Nï¼‰ï¼šä¸ªæ•° min(iâˆ’1,Nâˆ’i)+1ã€‚

- **åŒ…å« j** çš„åŒºé—´ï¼šè¿™æ—¶ `i=l+r-j`ã€‚æŠŠæ‰€æœ‰åˆæ³• `[l,r]` æ•°å‡ºæ¥ï¼Œå¾—åˆ°ä¸€ä¸ªåªä¸ `j,i` çš„ç®€å•å¼ï¼Œ0-basedå†™æ³•æ˜¯

$$
\boxed{\ \text{cnt\_in}(j,i)=
  \begin{cases}
    \min(j+1,\ N-i), & i\ge j,\\[2pt]
    \min(N-j,\ i+1), & i<j~.
  \end{cases}
}
$$

```c++
#include <bits/stdc++.h>
using namespace std;
 
#define all(x) begin(x), end(x)
#define FOR(i, a, b) for (int i = (a); i < (b); ++i)
#define F0R(i, a) FOR(i, 0, a)
 
using ll = int64_t;
 
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int N;
    cin >> N;
    vector<int> A(N), B(N);
    for (int &x : A) cin >> x;
    for (int &x : B) cin >> x;
    auto ways2 = [&](ll x) { return x * (x + 1) / 2; };
    ll ans = 0;
    F0R(i, N) if (A[i] == B[i]) {
        ans += ways2(i) + ways2(N - 1 - i) + min(i, N - 1 - i) + 1;
    }
    F0R(_, 2) {
        vector<vector<pair<int, int>>> with_oc(N + 1);
        F0R(i, N) {
            with_oc.at(B.at(i)).push_back({i, 1});// è®°å½•ï¼šå€¼ v=B[i] åœ¨ B é‡Œçš„å‡ºç° (i)
            with_oc.at(A.at(i)).push_back({i, 0});// è®°å½•ï¼šå€¼ v=A[i] åœ¨ A é‡Œçš„å‡ºç° (i)
        }
      //æŠŠå®ƒä»¬ä¸¢è¿›åŒä¸€ä¸ªæ¡¶ with_oc[v]ï¼Œä¹‹åâ€œæŒ‰ä¸‹æ ‡é¡ºåºæ··åˆâ€æ‰«æï¼Œå°±èƒ½æµå¼åœ°æŠŠæ‰€æœ‰ (j,i) çš„é‚£ä¸€éƒ¨åˆ† ç´¯åŠ     æ‰ï¼Œè€Œä¸éœ€è¦åŒé‡å¾ªç¯ã€‚
       //A=[2,1,2], B=[1,2,2]ï¼Œåˆ™
       //with_oc[1] = {(1,0), (0,1)} // Aä¸­1åœ¨j=1ï¼ŒBä¸­1åœ¨i=0
       //with_oc[2] = {(0,0),(2,0),(1,1),(2,1)} // Aä¸­2åœ¨j=0,2ï¼›Bä¸­2åœ¨i=1,2
        FOR(v, 1, N + 1) {
            reverse(all(with_oc.at(v)));
            stack<int> stk; // å­˜å½“å‰æ‰€æœ‰ tï¼ˆå•è°ƒä¸å‡ï¼‰
            int num_large = 0; // è¢«â€œæŒ‰ x è®°â€çš„ä¸ªæ•°ï¼ˆé‚£äº› >x çš„ tï¼‰
            ll sum_small = 0; // â‰¤x çš„ t ä¹‹å’Œ
            auto query = [&](int x) {
                while (!stk.empty() && stk.top() > x) {
                    ++num_large;
                    sum_small -= stk.top();
                    stk.pop();
                }
                return sum_small + (ll)num_large * x; // = Î£ min(t,x)
            };
            for (auto [idx, which] : with_oc.at(v)) {
                if (which == 0) {
                    ans += query(idx + 1);
                } else {
                    int v = N - idx;
                    sum_small += v;
                    stk.push(v);
                }
            }
        }
        reverse(all(A));
        reverse(all(B));
    }
    cout << ans << "\n";
}
//å•è°ƒæ ˆ
//æµå¼å­˜å‚¨ æµå¼æ‰«æ pairå‡½æ•°
//way2
//æ€è·¯
```

## ç”¨ä¸€ä¸ªå°ä¾‹å­å…·ä½“èµ°ä¸€é

å– `N=4`ï¼š

- `A=[2,1,2,1]`
- `B=[1,2,1,2]`

æŠŠâ€œå€¼ç­‰äº 1ã€2â€çš„å‡ºç°æŒ‰**åŒä¸€æ¡ä¸‹æ ‡æ—¶é—´çº¿**æ”¶é›†è¿›æ¡¶ï¼ˆæ³¨æ„ä»£ç æ˜¯æŒ‰ `i=0..N-1` ä¾æ¬¡æŠŠ `B[i]`ã€`A[i]` æ”¾è¿›å»ï¼Œå› æ­¤**åè½¬å**å°±æ˜¯**æŒ‰ä¸‹æ ‡é€’å‡**çš„æ··åˆåºåˆ—ï¼‰ï¼š

- å¯¹å€¼ `v=1`ï¼š
  - åŸé¡ºåº `with_oc[1] = [(0,1),(1,0),(2,1),(3,0)]`
     ï¼ˆ`(idx,which)`ï¼Œ`which=1` è¡¨ç¤ºæ¥è‡ª Bï¼Œ`which=0` è¡¨ç¤ºæ¥è‡ª Aï¼‰
  - åè½¬å `[(3,0),(2,1),(1,0),(0,1)]` â€”â€”ä¸‹æ ‡ä¾æ¬¡ 3,2,1,0ï¼ˆä»å³å¾€å·¦ï¼‰
- å¯¹å€¼ `v=2`ï¼š
  - åŸé¡ºåº `[(0,0),(1,1),(2,0),(3,1)]`
  - åè½¬å `[(3,1),(2,0),(1,1),(0,0)]`

### å…ˆçœ‹ `v=1` è¿™ä¸€æ¡¶ï¼ˆç¬¬ä¸€è¶Ÿï¼Œä¸åè½¬ A/Bï¼‰

æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªâ€œâˆ‘minâ€çš„**å•è°ƒæ ˆ**ï¼šé‡åˆ° B çš„ `i` å‹å…¥ `t=N-i`ï¼›é‡åˆ° A çš„ `j` å°±æŸ¥è¯¢ `query(x=j+1)`ï¼Œè¿”å›å½“å‰æ‰€æœ‰ `t` çš„ âˆ‘min(t,x)ã€‚

åºåˆ— `[(3,0),(2,1),(1,0),(0,1)]` ä¾æ¬¡å¤„ç†ï¼š

1. `(3,0)`ï¼šA çš„ `j=3`ã€‚æ­¤æ—¶è¿˜æ²¡è§åˆ°ä»»ä½• B â‡’ è´¡çŒ® 0ã€‚
2. `(2,1)`ï¼šB çš„ `i=2`ã€‚å‹å…¥ `t=N-i=4-2=2`ã€‚
3. `(1,0)`ï¼šA çš„ `j=1`ã€‚æ­¤æ—¶â€œå·²å…¥åº“çš„ Bâ€åªæœ‰ `i=2`ï¼Œæ‰€ä»¥è®¡ç®—
    min(Nâˆ’i, j+1)=min(2,2)=2ï¼ŒåŠ  2ã€‚
4. `(0,1)`ï¼šB çš„ `i=0`ã€‚å‹å…¥ `t=4-0=4`ï¼ˆç•™ç»™åé¢åˆ«çš„`j` ç”¨ï¼‰ã€‚

è¿™ä¸€æ¡¶åœ¨ç¬¬ä¸€è¶Ÿè´¡çŒ®äº† 2ï¼›å®ƒæ­£æ˜¯
$$
\sum_{\substack{A[j]=B[i]=1\\ i\ge j}} \min(N-i,\ j+1)
= \min(4-2,1+1)=2.
$$

> å…³é”®ï¼šæˆ‘ä»¬**æ²¡ç”¨åŒé‡å¾ªç¯**æšä¸¾ $(j,i)$ï¼›åªæ˜¯â€œæ··åˆæ‰«æä¸€æ¬¡â€ï¼Œæ¯é‡åˆ°ä¸€ä¸ª `j`ï¼Œç”¨å½“å‰æ ˆé‡Œæ‰€æœ‰ `t` ç»Ÿä¸€ç®—äº†ä¸€æ¬¡ $\sum \min$ã€‚è€Œâ€œæ ˆ + åå‘æ‰«æâ€ä¿è¯è¿™å°±æ˜¯â€œæ‰€æœ‰ $i\ge j$â€é‚£éƒ¨åˆ†çš„å’Œã€‚

### å†çœ‹ `v=2` è¿™ä¸€æ¡¶ï¼ˆç¬¬ä¸€è¶Ÿï¼‰

åºåˆ— `[(3,1),(2,0),(1,1),(0,0)]`ï¼š

1. `(3,1)`ï¼šB çš„ `i=3`ã€‚å‹å…¥ `t=4-3=1`ã€‚
2. `(2,0)`ï¼šA çš„ `j=2`ã€‚æ­¤æ—¶â€œå·²å…¥åº“ Bâ€åªæœ‰ $i=3$ï¼ŒåŠ  $\min(4-3,2+1)=1$ã€‚
3. `(1,1)`ï¼šB çš„ `i=1`ã€‚å‹å…¥ `t=3`ã€‚
4. `(0,0)`ï¼šA çš„ `j=0`ã€‚æ­¤æ—¶â€œå·²å…¥åº“ Bâ€ä¸º `i=3,1`ï¼›
    $\min(4-3,0+1)+\min(4-1,0+1)=\min(1,1)+\min(3,1)=1+1=2$ã€‚

è¿™ä¸€æ¡¶ç¬¬ä¸€è¶Ÿè´¡çŒ® $1+2=3$ï¼Œç­‰äº
$$
\sum_{\substack{A[j]=B[i]=2\\ i\ge j}} \min(N-i,\ j+1)
= \min(1,3)+\min(3,1)=1+1=2 \quad(\text{å¯¹ } j=0)
+ \min(1,3)=1\quad(\text{å¯¹ } j=2)
$$

### ç¬¬äºŒè¶Ÿï¼ˆæŠŠ Aã€B æ•´ä½“åè½¬åï¼Œå†åšåŒæ ·çš„æµç¨‹ï¼‰

ä¼šå¯¹æ¯ä¸ªå€¼æŠŠ**å¦ä¸€åŠ**ï¼ˆ$i çš„éƒ¨åˆ†ï¼‰
$$
\sum \min(N-j,\ i+1)
$$
ç´¯åŠ ä¸Šã€‚åŸå› æ˜¯åè½¬åç´¢å¼•å˜æ¢ `i'=N-1-i,\ j'=N-1-j`ï¼Œè¿™è¶Ÿä»ç„¶åšâ€œé‡ B å…¥ `t'=N-i'=i+1`ï¼Œé‡ A æŸ¥ `x'=j'+1=N-j`â€ä¸”åªè¦†ç›– `i'\ge j'`ï¼ˆä¹Ÿå°±æ˜¯åŸæ¥çš„ $iï¼‰ã€‚

ä¸¤è¶Ÿç›¸åŠ ï¼Œå°±æŠŠ
$$
\text{cnt\_in}(j,i)=
\begin{cases}
\min(N-i,\ j+1), & i\ge j,\\
\min(N-j,\ i+1), & i<j
\end{cases}
$$
å¯¹**æ‰€æœ‰** `(j,i)`ï¼ˆä¸” `A[j]=B[i]`ï¼‰çš„è´¡çŒ®éƒ½åŠ å®Œäº†ã€‚

### Problem 2. Cow Checkups

### ğŸ§© é¢˜æ„ï¼š

Farmer John æœ‰ä¸€ä¸ªæ•°ç»„ `a[1..N]` å’Œä¸€ä¸ªæ•´æ•° `M`ã€‚
 ä»–æƒ³é€šè¿‡ **å¯¹æ•°ç»„å…ƒç´ åŠ  1 æˆ–å‡ 1**ï¼Œä½¿å¾—

> å¯¹äºæ‰€æœ‰ `i`ï¼Œéƒ½æœ‰ `(a[i] - x)` èƒ½è¢« `M` æ•´é™¤ã€‚

æˆ‘ä»¬è¦æ±‚å‡ºï¼š
 å¯¹äºæ‰€æœ‰å¯èƒ½çš„æ•´æ•° `x`ï¼ŒFJ éœ€è¦çš„**æœ€å°‘æ“ä½œæ¬¡æ•°**ï¼ˆæ¯åŠ  1 æˆ–å‡ 1 è®°ä½œä¸€æ¬¡æ“ä½œï¼‰ã€‚

### ğŸ¯ é—®é¢˜è½¬åŒ–

æˆ‘ä»¬å¯ä»¥æŠŠé—®é¢˜æ¢ä¸ªè§’åº¦çœ‹ã€‚

å¯¹äºæ¯ä¸ª `a[i]`ï¼Œæˆ‘ä»¬è¦è°ƒæ•´å®ƒï¼Œä½¿å¾—ï¼š

```c++
a[i] â‰¡ x (mod M)
```

ä¹Ÿå°±æ˜¯ `a[i]` å’Œ `x` åœ¨æ¨¡ `M` æ„ä¹‰ä¸‹ç›¸ç­‰ã€‚

æ¢å¥è¯è¯´ï¼Œ`a[i] % M` åº”è¯¥ä¸ `x % M` ç›¸åŒã€‚
 å› æ­¤æˆ‘ä»¬å¯ä»¥å®šä¹‰ï¼š

```c++
resid[i] = a[i] % M
```

FJ æƒ³è®©æ‰€æœ‰å…ƒç´ çš„ä½™æ•°éƒ½ç­‰äº `x % M`ã€‚

### ğŸ§® è®¡ç®—ã€Œæœ€å°‘æ“ä½œæ¬¡æ•°ã€

æˆ‘ä»¬å¯ä»¥æŠŠ `a[i]` è°ƒæ•´åˆ°**æœ€è¿‘çš„é‚£ä¸ªæ•°**ï¼Œä½¿å¾—å®ƒå¯¹ `M` å–ä½™åç­‰äº `x`ã€‚

### ä¸¾ä¸ªä¾‹å­ï¼š

å‡è®¾ `M = 9`ï¼Œ`a[i] = 15`ï¼Œ`x = 3`ã€‚

æˆ‘ä»¬è¦è®© `(a[i] - x)` æ˜¯ `9` çš„å€æ•°ã€‚
 ä¹Ÿå°±æ˜¯è®© `a[i] â‰¡ 3 (mod 9)`ã€‚

`15 mod 9 = 6`
 è¦ä» 6 å˜æˆ 3ï¼Œæœ‰ä¸¤ç§åŠæ³•ï¼š

1. **å¾€ä¸‹è°ƒ**ï¼šä» 6 â†’ 3ï¼Œå·® 3ã€‚
2. **å¾€ä¸Šè°ƒ**ï¼šä» 6 â†’ 3 + 9 = 12ï¼Œå¤šäº† 6ã€‚

å–è¾ƒå°çš„é‚£ä¸ªï¼ˆ3ï¼‰ï¼Œæ‰€ä»¥æœ€å°‘è¦æ“ä½œ 3 æ¬¡ã€‚

### âœ³ï¸ é€šç”¨å…¬å¼

å¯¹äºæ¯ä¸ª `a[i]` å’ŒæŸä¸ªä½™æ•°ç›®æ ‡ `x`ï¼š

```c++
delta = abs(resid[i] - x)
cost_i = min(delta, M - delta)
```

ä¸ºä»€ä¹ˆè¦å– `min(M - delta)` å‘¢ï¼Ÿ

å› ä¸ºæ¨¡å¾ªç¯ä¸‹ï¼Œæ¯”å¦‚ `M = 9` æ—¶ï¼š

- `resid[i] = 8`, `x = 1`
  - ç›´æ¥å·®è· `|8 - 1| = 7`
  - ä½†æ˜¯ä½ å¯ä»¥å¾€ä¸ŠåŠ  2ï¼ˆå› ä¸º 8â†’9â†’0â†’1ï¼‰
  - æ‰€ä»¥å®é™…æœ€å°æ­¥æ•°æ˜¯ `min(7, 9 - 7 = 2) = 2`

æ‰€ä»¥ï¼š

```c++
cost_i = min(|resid[i] - x|, M - |resid[i] - x|)
```

### ğŸ’¡æ€»æ“ä½œæ•°

FJ çš„æ— èŠå€¼ï¼ˆæ€»æ“ä½œæ¬¡æ•°ï¼‰ï¼š

```
sum_i cost_i
```

æˆ‘ä»¬è¦å¯¹æ‰€æœ‰å¯èƒ½çš„ `x`ï¼ˆ`0 â‰¤ x < M`ï¼‰è®¡ç®—ä¸Šé¢çš„å€¼ï¼Œå–æœ€å°ã€‚

ä»£ç ï¼š

```c++
#include <bits/stdc++.h>
using namespace std;
using int64 = long long;

/*
è§£æ³•ï¼š
  - æŠŠä½™æ•°æ’åºï¼Œå¤åˆ¶ä¸€ä»½åŠ ä¸Š Mï¼ˆå±•å¼€åœ†ç¯æˆç›´çº¿ï¼‰ã€‚
  - ç”¨åŒæŒ‡é’ˆç»´æŠ¤ä¸€ä¸ªçª—å£ [k..j]ï¼Œæ»¡è¶³ r2[j] - r2[k] <= M/2ã€‚
    å¯¹çª—å£å†…çš„ç‚¹ï¼Œç›´æ¥å·®å€¼ï¼›çª—å£å¤–çš„ç‚¹ï¼Œå·®å€¼å– M - (r - t)ã€‚
  - ç”¨å‰ç¼€å’Œå¿«é€Ÿè®¡ç®—å·®å€¼æ€»å’Œã€‚
  - æšä¸¾æ¯ä¸ª r2[k] ä½œä¸ºå€™é€‰ tï¼Œå–æœ€å°å€¼ã€‚
å¤æ‚åº¦ï¼š
  æ’åº O(N log N)ï¼ŒåŒæŒ‡é’ˆæ‰«æ O(N)ï¼Œé€‚åˆ N â‰¤ 2e5ã€‚
*/

long long solve_case(int N, long long M, vector<long long>& A) {
    // 1. è®¡ç®—ä½™æ•°
    vector<long long> r(N);
    for (int i = 0; i < N; i++) {
        r[i] = A[i] % M;
    }
    sort(r.begin(), r.end());

    // 2. å¤åˆ¶ä¸€ä»½ +M
    vector<long long> r2(2 * N);
    for (int i = 0; i < N; i++) {
        r2[i] = r[i];
        r2[i + N] = r[i] + M;
    }

    // 3. å‰ç¼€å’Œ
    vector<long long> pref(2 * N + 1, 0);
    for (int i = 0; i < 2 * N; i++) {
        pref[i + 1] = pref[i] + r2[i];
    }
    long long ans = LLONG_MAX;
    int j = 0;
    double half = M / 2.0;

    // 4. æšä¸¾æ¯ä¸ªèµ·ç‚¹ k
    for (int k = 0; k < N; k++) {
        if (j < k) j = k;
        // æ‰©å±• jï¼Œä¿è¯åŒºé—´é•¿åº¦ <= M/2
        while (j + 1 < k + N && (r2[j + 1] - r2[k]) <= half) {
            j++;
        }

        int cnt1 = j - k + 1; // çª—å£å†…å…ƒç´ ä¸ªæ•°
        long long sum1 = (pref[j + 1] - pref[k]) - 1LL * cnt1 * r2[k];
        // çª—å£å¤–å…ƒç´ ä¸ªæ•°
        int cnt2 = N - cnt1;
        long long sum_right = (pref[k + N] - pref[j + 1]);
        // çª—å£å¤–è·ç¦»å…¬å¼ï¼šcnt2*M - (sum_right - cnt2 * r2[k])
        long long sum2 = 1LL * cnt2 * M - (sum_right - 1LL * cnt2 * r2[k]);

        long long total = sum1 + sum2;
        ans = min(ans, total);
    }

    return ans;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    int T;
    cin >> T;
    while (T--) {
        int N;
        long long M;
        cin >> N >> M;
        vector<long long> A(N);
        for (int i = 0; i < N; i++) cin >> A[i];

        cout << solve_case(N, M, A) << "\n";
    }
    return 0;
}

```

### Problem 3. Transforming Pairs

### ğŸ§© é¢˜æ„ï¼š

- åˆå§‹æœ‰ä¸¤ä¸ªå †ï¼š`(a, b)`ã€‚
- æ“ä½œæœ‰ä¸¤ç§ï¼š
  1. æŠŠ pile1 å¢åŠ  pile2 çš„å¤§å° â†’ `(a+b, b)`
  2. æŠŠ pile2 å¢åŠ  pile1 çš„å¤§å° â†’ `(a, a+b)`
- è¦é—®èƒ½å¦ç»è¿‡è‹¥å¹²æ­¥æ“ä½œå¾—åˆ° `(c, d)`ï¼Œå¦‚æœèƒ½ï¼Œè¦æœ€å°‘å¤šå°‘æ­¥ã€‚

### ğŸ¯ è§‚å¯Ÿ

1. **åªèƒ½å¢å¤§ï¼Œä¸èƒ½å‡å°‘**
    å¦‚æœ `c < a` æˆ– `d < b`ï¼Œç›´æ¥ä¸å¯èƒ½ã€‚

2. **å¢é•¿æ¨¡å¼ç±»ä¼¼æ–æ³¢é‚£å¥‘**
    æ¯æ¬¡æ“ä½œæ˜¯â€œåŠ ä¸Šå¯¹æ–¹â€ã€‚è¿™å’Œæ¬§å‡ é‡Œå¾—ç®—æ³•æ˜¯é€†è¿‡ç¨‹ã€‚
    æ¯”å¦‚ `(5,3)` å˜ `(8,3)` æˆ– `(5,8)`ï¼Œå¾ˆåƒ gcd çš„â€œå‡æ³•ç‰ˆâ€ã€‚

3. **ä¸å¯è¾¾æƒ…å†µ**
    å¦‚æœ gcd ä¸ä¸€è‡´ï¼Œå°±ä¸å¯èƒ½ã€‚
    å› ä¸ºæ¯æ¬¡æ“ä½œç›¸å½“äºçº¿æ€§ç»„åˆï¼šæœ€ç»ˆ `(c,d)` å¿…é¡»æ»¡è¶³

   ```
   gcd(c, d) == gcd(a, b)
   ```

   å¦åˆ™ç­”æ¡ˆæ˜¯ -1ã€‚

4. **æœ€å°‘æ­¥æ•°**
    è¦ä» `(a,b)` èµ°åˆ° `(c,d)`ï¼Œå°±æ˜¯æ¨¡æ‹Ÿâ€œåå‘æ¬§å‡ é‡Œå¾—ç®—æ³•â€ï¼š

   - ä» `(c,d)` å€’æ¨å› `(a,b)`
   - æ¯æ¬¡æŠŠå¤§çš„å‡å»å°çš„ï¼ˆä½†å…è®¸ä¸€æ¬¡æ€§å‡å¾ˆå¤šå€ï¼Œç›¸å½“äºå¿«é€Ÿè·³è¿‡ï¼‰ã€‚

### ğŸ“Œ Case1: åˆå§‹ `(5,3)` â†’ ç›®æ ‡ `(8,19)`ã€‚

- ç›®æ ‡ gcd(8,19) = 1ï¼Œåˆå§‹ gcd(5,3)=1 âœ…å¯è¡Œã€‚

- å€’æ¨ï¼š

  ```
  (8,19) â†’ (8,11) â†’ (8,3) â†’ (5,3)
  ```

- æ€»å…± 3 æ­¥ã€‚

### ğŸ“Œ Case2: åˆå§‹ `(5,3)` â†’ ç›®æ ‡ `(19,8)`ã€‚

- gcd(19,8)=1ï¼Œgcd(5,3)=1 âœ…å¯è¡Œã€‚
- å€’æ¨æ—¶å‘ç° `(19,8)` â†’ `(11,8)` â†’ `(3,8)`ï¼Œä½† `(3,8)` gcd=1ï¼Œå·²ç»å°äº `(5,3)`ï¼Œå›ä¸å»äº† âŒã€‚
- æ‰€ä»¥ç­”æ¡ˆ `-1`ã€‚

ğŸ“Œ Case3: åˆå§‹ `(5,3)` â†’ ç›®æ ‡ `(5,3)`ã€‚

- ç›´æ¥ç›¸ç­‰ï¼Œç­”æ¡ˆ `0`ã€‚

***

### âœ³ï¸ è§£é¢˜ç®—æ³•ï¼ˆåå‘æ¨¡æ‹Ÿï¼‰

1. å¦‚æœ `c < a or d < b` â†’ `-1`
2. å¦‚æœ `gcd(c, d) != gcd(a, b)` â†’ `-1`
3. å¦åˆ™ï¼Œä» `(c,d)` å¼€å§‹åæ¨åˆ° `(a,b)`ï¼š
   - å¦‚æœ `c > d`ï¼Œåˆ™ `c -= k*d`
   - å¦‚æœ `d > c`ï¼Œåˆ™ `d -= k*c`
   - å…¶ä¸­ `k` å–å°½é‡å¤§çš„ï¼Œä½¿å¾— `c,d` ä¸å°äºç›®æ ‡ `(a,b)`ã€‚
   - ç»Ÿè®¡æ­¥æ•°ã€‚
4. å¦‚æœæœ€ç»ˆèƒ½åˆ° `(a,b)`ï¼Œè¾“å‡ºæ­¥æ•°ï¼Œå¦åˆ™ `-1`ã€‚

```c++
#include <bits/stdc++.h>
using namespace std;
using int64 = long long; // é¢˜ç›®èŒƒå›´ 1 â‰¤ a,b,c,d â‰¤ 1e18

// å¤„ç†å•ä¸ªæµ‹è¯•ç”¨ä¾‹
long long solve(long long a, long long b, long long c, long long d) {
    long long res = 0;
    while (true) {
        // å¦‚æœå·²ç»åˆ°è¾¾ç›®æ ‡
        if (a == c && b == d) return res;

        // ç¡®ä¿ c >= dï¼Œå¦åˆ™äº¤æ¢ä¸¤å †ï¼ˆå¯¹åº” Python é‡Œçš„ if c < d: swapï¼‰
        if (c < d) {
            swap(a, b);
            swap(c, d);
        }

        // ä¸å¯èƒ½æƒ…å†µ
        if (a > c || b > d || d == 0) return -1;

        // å¦‚æœ b == dï¼Œå¯ä»¥ç›´æ¥æ£€æŸ¥ c æ˜¯å¦èƒ½é€šè¿‡åŠ è‹¥å¹²æ¬¡ d å˜æˆç›®æ ‡
        if (b == d && (c - a) % d == 0) {
            res += (c - a) / d;//åªéœ€æ£€æŸ¥ (c - a) æ˜¯å¦èƒ½æ•´é™¤ dï¼Œèƒ½çš„è¯ä¸€æ¬¡ç®—å‡ºå¤šå°‘æ­¥ã€‚
            return res;
        }
        // å¦åˆ™ï¼Œåšä¸€æ¬¡ç±»ä¼¼ "c %= d" çš„å¤§æ­¥è·³è·ƒ
        res += c / d;
        c %= d;
    }
    return res;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    int T;
    cin >> T;
    while (T--) {
        long long a, b, c, d;
        cin >> a >> b >> c >> d;
        cout << solve(a, b, c, d) << "\n";
    }
    return 0;
}

```

***

## USACO 2025 January Contest, Bronze

### Problem 1. Astral Superposition

é¢˜æ„ï¼š ä¸€ä¸ªNâœ–ï¸Næ–¹æ ¼ï¼Œæ¯ä¸ªæ–¹æ ¼å¯èƒ½ä¼šæœ‰ä¸€ä¸ªæ˜Ÿæ˜Ÿã€‚ç»è¿‡å˜åŒ–åï¼ŒåŸæ¥çš„æ˜Ÿæ˜Ÿå¯èƒ½ä¼šæ¶ˆå¤±ï¼Œä¹Ÿå¯èƒ½ä¼šå‘å³ç§»åŠ¨Aã€å†å‘ä¸‹ç§»åŠ¨Bã€‚å¦‚æœæ˜Ÿæ˜Ÿç§»åŠ¨å‡ºç•Œæˆ–æ¶ˆå¤±ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°åœ¨ç¬¬äºŒå¼ ç…§ç‰‡ã€‚ç°åœ¨ä¸¤å¼ ç…§ç‰‡é‡å ï¼Œå¦‚æœæ²¡æœ‰æ˜Ÿæ˜Ÿï¼Œæ˜¾ç¤ºWhiteã€‚å¦‚æœä¸€ä¸ªæ˜Ÿæ˜Ÿï¼Œæ˜¾ç¤ºGrayï¼Œå¦‚æœä¸¤ä¸ªæ˜Ÿæ˜Ÿï¼Œæ˜¾ç¤ºBlackã€‚ç°åœ¨ç»™å‡ºé‡å åçš„å½±åƒï¼Œä»¥åŠAï¼ŒBå€¼ï¼Œæ±‚ç¬¬ä¸€å¼ å›¾çš„æœ€å°æ˜Ÿæ˜Ÿæ•°ã€‚

æ€è·¯ï¼š![idea](./images/6.png)

```Python
WGB={
    'W':0,
    'G':1,
    'B':2,
}
def _case():
    N,A,B=[int(x) for x in input().split()]
    map3=[[WGB[x] for x in input()] for _ in range(N)]
    map1=[[0 for _ in range(N)] for _ in range(N)]
   
    for i in range(N):
        for j in range(N):
            if map3[i][j]==2:
                map1[i][j]=1
                if i<B or j<A:
                    print(-1)
                    return 
                if map3[i-B][j-A]==0:
                    print(-1)
                    return
                map1[i-B][j-A]=1
    
    for i in range(N):
        for j in range(N):
            if map3[i][j]==1:
                if map1[i][j]==1:
                    continue
                if i<B or j<A:
                    map1[i][j]=1
                    continue
                if map1[i-B][j-A]==1:
                    continue
                map1[i][j]=1

    print(sum(sum(x) for x in map1))

T=int(input())
while T:
    T-=1
    _case()
```

```c++
#include <bits/stdc++.h>
using namespace std;

int cv(char c) { // 'W','G','B' -> 0,1,2
    if (c == 'W') return 0;
    if (c == 'G') return 1;
    return 2; // 'B'
}

void solve_case() {
    int N, A, B;
    if (!(cin >> N >> A >> B)) return;

    vector<vector<int>> map3(N, vector<int>(N));
    for (int i = 0; i < N; ++i) {
        string s; cin >> s;               // é•¿åº¦ä¸º N çš„ W/G/B å­—ç¬¦ä¸²
        for (int j = 0; j < N; ++j)
            map3[i][j] = cv(s[j]);
    }

    vector<vector<int>> map1(N, vector<int>(N, 0));

    // ç¬¬ä¸€è½®ï¼šå¤„ç† 'B'ï¼ˆå€¼ 2ï¼‰
    for (int i = 0; i < N; ++i) {
        for (int j = 0; j < N; ++j) {
            if (map3[i][j] == 2) {
                map1[i][j] = 1;
                if (i < B || j < A) {            // è¶Šç•Œ
                    cout << -1 << '\n';
                    return;
                }
                if (map3[i - B][j - A] == 0) {   // å¯¹åº”ä½ç½®æ˜¯ 'W'
                    cout << -1 << '\n';
                    return;
                }
                map1[i - B][j - A] = 1;
            }
        }
    }

    // ç¬¬äºŒè½®ï¼šå¤„ç† 'G'ï¼ˆå€¼ 1ï¼‰
    for (int i = 0; i < N; ++i) {
        for (int j = 0; j < N; ++j) {
            if (map3[i][j] == 1) {
                if (map1[i][j] == 1) continue;
                if (i < B || j < A) {            // æ”¾è‡ªå·±
                    map1[i][j] = 1;
                    continue;
                }
                if (map1[i - B][j - A] == 1) continue;
                map1[i][j] = 1;
            }
        }
    }

    long long ans = 0;
    for (int i = 0; i < N; ++i)
        for (int j = 0; j < N; ++j)
            ans += map1[i][j];

    cout << ans << '\n';
}

int main() {
    int T; 
    cin>>T;
    while (T--) solve_case();
    return 0;
}
//vector<vector<int>>äºŒç»´æ•°ç»„
//æŠŠå­—ç¬¦è½¬æ¢æˆæ•°å­—å­˜å‚¨
//åˆ†è§£é—®é¢˜ï¼Œæ‰¾å‡ºè§£é¢˜ç‚¹
```

### Problem 2. It's Mooin' Time II

é¢˜æ„ï¼ša2,â€¦,aNa1,a2,â€¦,aNï¼Œå“å“å«abbã€‚

```python
N=int(input())
nums=[int(x) for x in input().split()]

cnt=[0]*(N+1)
right=[0]*(N+1)
diff=0
ans=0

for i in range(N):
    right[nums[i]]+=1

for i in range(N):
    if right[nums[i]]==2:
        ans+=diff-(cnt[nums[i]]>0)
    right[nums[i]]-=1
    diff+=cnt[nums[i]]==0
    cnt[nums[i]]+=1

print(ans)
```

```c++
#include <bits/stdc++.h>
using namespace std;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    int N;
    cin >> N;
    vector<int> nums(N);
    for (int i = 0; i < N; ++i) cin >> nums[i];

    vector<int> left(N + 1, 0), right(N + 1, 0);
    long long ans = 0;
    int distinct_left = 0;

    // ç»Ÿè®¡æ¯ä¸ªå€¼æ€»å‡ºç°æ¬¡æ•°ï¼ˆæ”¾åˆ° rightï¼‰
    for (int i = 0; i < N; ++i) right[nums[i]]++;

    for (int i = 0; i < N; ++i) {
        int v = nums[i];
        if (right[v] == 2) {
            // åœ¨å€’æ•°ç¬¬äºŒæ¬¡å‡ºç°çš„ä½ç½®ç»“ç®—
            ans += (long long)distinct_left - (left[v] > 0 ? 1 : 0);
        }
        right[v] -= 1;
        distinct_left += (left[v] == 0 ? 1 : 0);
        left[v] += 1;
    }

    cout << ans << '\n';
    return 0;
}

```

### Problem 3. Cow Checkups

é¢˜æ„ï¼šNå¤´ç‰›çš„æ’åˆ—é¡ºåºæ˜¯a1,a2,â€¦,aNï¼ŒåŒ»ç”Ÿéœ€æ¯å¤´ç‰›ä¸å…¶å¯¹åº”çš„b1,b2,â€¦,bNç›¸åŒæ‰ä¸ºå…¶åŒ»æ²»ã€‚è¾“å‡ºN+1è¡Œï¼Œæ¯è¡Œä½¿å¾— iâˆ’1 å¤´å¥¶ç‰›è¢«æ£€æŸ¥çš„æ“ä½œæ•°é‡ã€‚

æ€è·¯ï¼š1ï¸âƒ£ å…ˆè®¡ç®—åŸå§‹ same = `sum(A[i]==B[i])`ã€‚
 2ï¸âƒ£ å¯¹æ¯ä¸ªä¸­å¿ƒ mid ï¼Œå‘ä¸¤è¾¹æ‰©å±•ï¼ˆç›¸å½“äºæ¨¡æ‹Ÿæ‰€æœ‰å¯èƒ½åè½¬åŒºé—´ï¼‰ã€‚
 æ¯æ¬¡äº¤æ¢ä¸¤ç«¯ A[l],A[r] åæ›´æ–°åŒ¹é…æ•° _sameï¼š
     _same -= (A[l]==B[l]) + (A[r]==B[r]) # æ’¤é”€æ—§ä½ç½®çš„åŒ¹é…
     _same += (A[l]==B[r]) + (A[r]==B[l]) # æ·»åŠ äº¤æ¢åæ–°åŒ¹é…
 ç„¶å ans[_same] ++
 åŒé‡è°ƒç”¨ expand(mid,mid) (å¥‡æ•°é•¿åº¦) å’Œ expand(mid,mid+1) (å¶æ•°é•¿åº¦)ã€‚

```python
def main():
    n = int(input())
    A = list(map(int, input().split()))
    B = list(map(int, input().split()))

    same=sum(1 for i in range(n) if A[i]==B[i])
    ans=[0]*(n+1)

    def expand(l,r):
        nonlocal same
        _same=same
        while l>=0 and r<n:
            _same-=(A[l]==B[l])+(A[r]==B[r])
            _same+=(A[l]==B[r])+(A[r]==B[l])
            ans[_same]+=1
            l-=1
            r+=1

    for mid in range(n):
        expand(mid,mid)
        expand(mid,mid+1)
    
    for res in ans:
        print(res)

if __name__ == "__main__":
    main()
```

```c++
#include <bits/stdc++.h>
using namespace std;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    int n;
    cin >> n;
    vector<int> A(n), B(n);
    for (int i = 0; i < n; ++i) cin >> A[i];
    for (int i = 0; i < n; ++i) cin >> B[i];

    int same = 0;
    for (int i = 0; i < n; ++i) if (A[i] == B[i]) ++same;

    vector<long long> ans(n + 1, 0);

    auto expand = [&](int l, int r) {
        int _same = same;  // å±€éƒ¨å·¥ä½œå‰¯æœ¬
        while (l >= 0 && r < n) {
            _same -= (A[l] == B[l]) + (A[r] == B[r]);
            _same += (A[l] == B[r]) + (A[r] == B[l]);
            ++ans[_same];
            --l; ++r;
        }
    };

    for (int mid = 0; mid < n; ++mid) {
        expand(mid, mid);       // å¥‡æ•°é•¿åº¦
        expand(mid, mid + 1);   // å¶æ•°é•¿åº¦
    }

    for (long long v : ans) {
        cout << v << endl;
    }
    return 0;
}

```

***

## ğŸŒ± ä»€ä¹ˆæ˜¯å•è°ƒæ ˆï¼Ÿ

**å•è°ƒæ ˆï¼ˆMonotonic Stackï¼‰** æ˜¯ä¸€ç§æ ˆçš„åº”ç”¨æŠ€å·§ï¼š

- åœ¨æ ˆä¸­å§‹ç»ˆä¿æŒå…ƒç´  **å•è°ƒé€’å¢** æˆ– **å•è°ƒé€’å‡**ã€‚
- ç”¨äºå¿«é€Ÿè§£å†³â€œ**ä¸‹ä¸€ä¸ªæ›´å¤§/æ›´å°å…ƒç´ **â€ç±»çš„é—®é¢˜ã€‚

------

## ğŸ”‘ å•è°ƒæ ˆçš„æ ¸å¿ƒæ€æƒ³

- éå†æ•°ç»„æ—¶ï¼ŒæŠŠå½“å‰å…ƒç´ å’Œæ ˆé¡¶æ¯”è¾ƒï¼š
  - å¦‚æœå½“å‰å…ƒç´ â€œç ´åäº†å•è°ƒæ€§â€ï¼Œå°±ä¸æ–­å¼¹æ ˆï¼Œç›´åˆ°æ ˆé‡æ–°ç¬¦åˆå•è°ƒæ€§ã€‚
  - è¿™æ ·æ ˆé‡Œä¿å­˜çš„å°±æ˜¯â€œå€™é€‰å…ƒç´ â€ã€‚

------

## ğŸ“˜ å¸¸è§åº”ç”¨

### 1. **ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  (Next Greater Element)**

ç»™å®šæ•°ç»„ `a[1..n]`ï¼Œå¯¹äºæ¯ä¸ª `a[i]`ï¼Œæ‰¾åˆ° **å³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„æ•°**ã€‚

**ä»£ç ç¤ºä¾‹ï¼ˆå•è°ƒé€’å‡æ ˆï¼‰**ï¼š

```C++
#include <bits/stdc++.h>
using namespace std;

int main() {
    vector<int> a = {2, 1, 5, 3, 4};
    int n = a.size();
    vector<int> ans(n, -1); // é»˜è®¤æ²¡æœ‰æ›´å¤§å…ƒç´ 

    stack<int> st; // å­˜ç´¢å¼•ï¼Œä¿æŒæ ˆä¸­å…ƒç´ é€’å‡
    for (int i = 0; i < n; i++) {
        while (!st.empty() && a[i] > a[st.top()]) {
            ans[st.top()] = a[i]; // æ‰¾åˆ°å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ 
            st.pop();
        }
        st.push(i);
    }

    for (int x : ans) cout << x << " "; // è¾“å‡ºï¼š5 5 -1 4 -1
}
```
